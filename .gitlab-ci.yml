image: python:latest

before_script:
 - apt-get update --yes
 - apt-get install --yes cmake
 - apt-get install --yes libblas3 liblapack3 liblapack-dev libblas-dev
 - python -m pip install pytest
 - python -m pip install numpy
 - python -m pip install h5py

stages:
  - build 
  
build:
  stage: build
  script:
  - export CMAKE_BUILD_PARALLEL_LEVEL=4
  - python -m pip -v install ./
  - python -m pytest
  rules:
    - if: $CI_COMMIT_REF_NAME != $CI_DEFAULT_BRANCH

.test:
  stage: test
  needs: 
  - build
  script:
  - cd tests
  - python -m pytest
  rules:
    - if: $CI_COMMIT_REF_NAME != $CI_DEFAULT_BRANCH

